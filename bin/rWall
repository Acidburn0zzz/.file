#!/bin/bash

STIME="4h" # Amount of time to sleep between changes
WALLS=(~/Pictures/Backgrounds/mokou/*.png)
WALLCMD="nitrogen --set-scaled --save"

if [ ${#WALLS[@]} == 0 ]; then exit; fi

# if rWall is already running kill the sleep
pid=$(pgrep -o $(basename $0))
if [ "$pid" != "$$" ]; then
  pkill -TERM -P $pid
  exit
fi

while true; do
  n="${WALLS[RANDOM % ${#WALLS[@]}]}"
  if [ -f "/tmp/.rWall" ]; then
    c=$(cat "/tmp/.rWall")
    while [ ${#WALLS[@]} -gt "2" -a "$n" == "$c" ]; do
      n="${WALLS[RANDOM % ${#WALLS[@]}]}"
    done
  fi
  echo $n
  $WALLCMD "$n"
  echo "$n" > "/tmp/.rWall"
  sleep $STIME
done
